<!DOCTYPE html>
<html lang="zh-cn">
<head>
    <meta charset="utf-8">
    <meta name="referrer" content="no-referrer"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <link rel="stylesheet" href="/css/bootstrap4.3.1.min.css">
    <link rel="stylesheet" href="/css/bootstrap-icons1.8.1.css">
    <script src="/js/lib/axios.js"></script>
    <script src="/js/lib/vue.js"></script>
    <script src="/js/lib/jq3.6.js"></script>
    <script src="/js/jquery-3.3.1.min.js"></script>
    <script src="/js/popper1.14.1.min.js"></script>
    <script src="/js/bootstrap4.3.1.min.js"></script>
    <link rel="stylesheet" href="/css/main.css">
    <title>kloping bot 授权码状态</title>
</head>
<body>
<center style="margin-top: 120px;color: white"><h1> kloping bot 个人中心 </h1></center>
<script src="/js/header-top.js"></script>
<div id="divm" class="container" style="margin-top: 45px">
    <div class="row" style="margin-bottom: 25px;">
        <div class="col-2"></div>
        <div style="border-radius: 15px;background-color: rgba(142,211,180,0.4);text-align: center;"
             class=" col-8">
            <br>
            <img style="max-width: 75px"
                 :src="user.icon"
                 alt="icon">
            <br>
            <br>
            <div class="media-body">
                <div class="input-group">
                    <div class="input-group-prepend">
                        <span class="input-group-text">昵称</span>
                    </div>
                    <input type="text" aria-label="name" class="form-control" :value="user.nickname">
                </div>
                <br>
                <div class="input-group">
                    <div class="input-group-prepend">
                        <span class="input-group-text">邮箱</span>
                    </div>
                    <input type="text" aria-label="name" class="form-control" :value="user.eid">
                </div>
                <br>
                <div class="input-group">
                    <div class="input-group-prepend">
                        <span class="input-group-text">绑定QQ</span>
                    </div>
                    <input type="text" aria-label="name" class="form-control" :value="user.qid">
                </div>
                <br>
                <div class="input-group">
                    <div class="input-group-prepend">
                        <span class="input-group-text">注册方式</span>
                    </div>
                    <input type="text" aria-label="name" class="form-control" :value="user.type">
                </div>
            </div>
            <br>
        </div>
    </div>
    <hr>
    <div class="row">
        <div class="col-2"></div>
        <div style="border-radius: 15px;background-color: rgba(142,211,180,0.4);text-align: center;" class="col-8">
            <hr>
            <form id="codeForm" class="form-inline">
                <div class="form-group mx-sm-5 mb-2">
                    <label for="codeP" class="sr-only">授权码</label>
                    <input type="text" class="form-control" id="codeP" :value="vd.code" placeholder="授权码">
                </div>
                <input v-show="k1" type="button" v-on:click="copy0()" class="btn btn-primary mb-2" value="复制"/>
                <input v-show="!k1" type="button" v-on:click="reqTry()" class="btn btn-primary mb-2"
                       value="授权码申请试用"/>
                <div :class="'form-group mx-sm-5 mb-2 '+ je0(vd.expire)">{{je(vd.expire)}}</div>
            </form>
            <hr>
        </div>
    </div>
</div>
<script src="/js/utils.js"></script>
<script>
    let vm1 = new Vue({
        el: "#divm",
        created: function () {
            axios.get("/user").then(function (response) {
                vm1.user = response.data
                if (vm1.user.auth === null || vm1.user.auth === "") {

                } else {
                    axios.get("/getVerify0?code=" + vm1.user.auth).then(function (response) {
                        vm1.k1 = true
                        vm1.vd = response.data
                        console.log(vm1.vd)
                    }).catch(function (err) {
                        alert(err);
                    })
                }
            }).catch(function (err) {
                alert(err);
            })
        }, data: {
            vd: {},
            user: {},
            k1: false
        }, methods: {
            je: function (t) {
                let dateTime = new Date(t)
                let nowTime = new Date()
                if (nowTime.getTime() > dateTime.getTime()) {
                    return "已过期"
                } else {
                    let year = dateTime.getFullYear()
                    let month = dateTime.getMonth() + 1
                    let day = dateTime.getDate()
                    return "至" + year + "-" + month + "-" + day
                }
            }
            , je0: function (t) {
                let dateTime = new Date(t)
                let nowTime = new Date()
                if (nowTime.getTime() > dateTime.getTime()) {
                    return "alert alert-danger"
                } else {
                    return "alert alert-success"
                }
            }
            , copy0: function (text) {
                let copyText = document.getElementById("codeP");
                copyText.select();
                copyText.setSelectionRange(0, 99999);
                navigator.clipboard.writeText(copyText.value);
            }
            , reqTry: function () {
                axios.get("/req-try").then(function (response) {
                    if (response.data != null) {
                        vm1.k1 = true
                        vm1.vd = response.data
                        console.log(vm1.vd)
                    } else {
                        alert("不符合申请条件或申请失败")
                    }
                }).catch(function (err) {
                    alert(err);
                })
            }
        }
    });
</script>
<script src="/js/footer-bottom.js"></script>
</body>
</html>